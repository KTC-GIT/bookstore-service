<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${book.title}">ì±… ìƒì„¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .book-cover {
            max-height: 500px;
            width: 100%;
            object-fit: contain;
            border: 1px solid #eee;
            padding: 20px;
            border-radius: 10px;
        }
        .badge-stock { font-size: 0.9rem; }
    </style>
</head>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
function addToCart(bookId) {
    let count = $("#quantity").val();
    // const count = document.getElementById('quantity').value;
    $.ajax({
       url : "/carts/items",
       type : "POST",
        contentType : "application/json; charset=utf-8",
        data: JSON.stringify({
            "bookId": Number(bookId),
            "quantity": Number(count)
        }),
        success : function(data){
           alert(data);
        },
        error : function(xhr, status, error){
            alert(xhr.responseText);
        },
        complete : function(){

        }
    });
    // alert(`ì±… ID: ${bookId}, ìˆ˜ëŸ‰: ${count}ê°œ\nì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ê¸°ëŠ¥ì€ ë‚´ì¼ êµ¬í˜„ ì˜ˆì •!`);
}
</script>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-5">
    <div class="container">
        <a class="navbar-brand" href="/">ğŸ“š íƒœì²œë¬¸ê³ </a>
    </div>
</nav>

<div class="container">
    <div class="row g-5">
        <div class="col-md-5">
            <img th:src="${book.thumbnailUrl}" class="book-cover bg-white shadow-sm" alt="ì±… í‘œì§€">
        </div>

        <div class="col-md-7">
            <div class="pb-3 border-bottom">
                <span class="badge bg-secondary mb-2" th:text="${book.publisher}">ì¶œíŒì‚¬</span>
                <h1 class="fw-bold" th:text="${book.title}">ì±… ì œëª©</h1>
                <p class="text-muted fs-5">
                    <span th:text="${book.author}">ì €ì</span> ì €
                </p>
            </div>

            <div class="py-4">
                <h2 class="text-danger fw-bold mb-3">
                    <span th:text="${#numbers.formatInteger(book.price, 0, 'COMMA')}">18,000</span>ì›
                </h2>

                <div class="mb-4">
                    <span th:if="${book.stockQuantity > 0}" class="badge bg-success badge-stock">íŒë§¤ì¤‘</span>
                    <span th:unless="${book.stockQuantity > 0}" class="badge bg-danger badge-stock">í’ˆì ˆ</span>
                    <span class="text-muted ms-2 small">ISBN: <span th:text="${book.isbn}"></span></span>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                    <input type="number" class="form-control w-25 me-2" value="1" min="1" id="quantity">

                    <button class="btn btn-primary btn-lg px-4"
                            th:onclick="|addToCart(${book.id})|">
                        ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°
                    </button>
                    <button class="btn btn-outline-dark btn-lg px-4" onclick="history.back()">
                        ëª©ë¡ìœ¼ë¡œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <h4 class="card-title border-bottom pb-3 mb-4">ğŸ“– ì±… ì†Œê°œ</h4>
                    <p class="card-text lh-lg text-secondary" th:text="${book.description}">
                        ì±… ë‚´ìš©ì´ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>